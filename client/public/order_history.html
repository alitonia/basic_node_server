<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./assets/css/base.css">
    <link rel="stylesheet" href="./assets/css/home/main.css">
    <link rel="stylesheet" href="./assets/css/transaction/transaction.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <link rel="stylesheet" href="./assets/css/home/footer.css">
    <link rel="stylesheet" href="./assets/css/cart/cart.css">
    <link rel="icon" href="./assets/images/favicon/favicon.ico"/>


    <title>View Orders</title>

    <style>
        .styled-table {
            border-collapse: collapse;
            margin: 25px 0;
            font-size: 0.9em;
            font-family: sans-serif;
            min-width: 900px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.15);
        }

        .styled-table thead tr {
            background-color: #33d286;
            color: #ffffff;
            text-align: left;
        }

        .styled-table thead tr th {
            text-align: center;
        }

        .styled-table th,
        .styled-table td {
            padding: 12px 15px;
        }

        .styled-table tbody tr {
            border-bottom: 1px solid #dddddd;
        }

        .styled-table tbody tr:nth-of-type(even) {
            background-color: #f3f3f3;
        }

        .styled-table tbody tr:last-of-type {
            border-bottom: 2px solid #33d286;
        }

        .styled-table tbody tr.active-row {
            font-weight: bold;
            color: #33d286;
        }

        .action-button {
            padding: 6px 16px;
            background: #33d286;
            border: none;
            border-radius: 5px;
            font-size: 17px;
            color: white;
            font-weight: bold;
            cursor: pointer;
        }

        .action-button:hover {
            background: #fb9300;
        }

    </style>
    <script src="./assets/js/cart.js">
    </script>
</head>
<body>
<div class="shop">
    <header class="header">
        <div class="grid">
            <div class="header_navbar">
                <a href="./home.html">
                    <div class="logo">
                        <img src="./assets/images/logo/logo.png" alt="logo">
                    </div>
                </a>
                <div class="menu_wrap">
                    <div class="main_menu">
                        <ul class="menu_list">
                            <li class="menu_item home">
                                <a href="./home.html">HOME</a>
                            </li>
                            <li class="menu_item men">
                                <a href="./men.html">MEN</a>
                            </li>
                            <li class="menu_item women">
                                <a href="./women.html">WOMEN</a>
                            </li>
                            <li class="menu_item">
                                <a href="./contact.html">CONTACT</a>
                            </li>
                            <li class="menu_item">
                                <a class="aboutus" href="./aboutus.html">ABOUT US</a>
                            </li>
                            <li class="menu_item">
                                <a href="./cart_page.html">CART</a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <div class="transaction_title_area">
        <div class="transaction_container">
            <div class="col_left">
                <h2>Your Orders</h2>
            </div>
            <div class="col_right">
                <ul class="list_nav">
                    <li><a href="./home.html">Home</a></li>
                    <li><span>View Orders</span></li>
                </ul>
            </div>
        </div>
    </div>

    <div class="cart_page_area">
        <div class="cart_page_container" style="overflow: scroll;">

            <div class="board-space" style="width:100%">
                <table class="styled-table">
                    <thead>
                    <tr>
                        <th>Id</th>
                        <th>Date</th>
                        <th>Status</th>
                        <th rowspan="3">Actions</th>
                    </tr>
                    </thead>

                    <tbody class="injectable-space">
                    </tbody>

                </table>

            </div>

            <div class="cart_continue">
                <!-- Choose next action  -->
                <div class="continue_shopping home_button" style="cursor:pointer;"
                     onclick="(()=>{window.location.href = './home.html'})()"
                >
                    <a href="./home.html" style="text-decoration: none;color: #ffffff;">Continue Shopping</a>
                </div>
            </div>
        </div>

    </div>


    <footer class="footer">
        <div class="footer-container">
            <div class="footer_container_info">
                <div class="single_footer">
                    <h4>CONTACT</h4>
                    <ul>
                        <li>4060 Reppert Coal Road, MS</li>
                        <li>39201 USA</li>
                        <li>(+123) 685 78</li>
                        <li>(+123) 685 78</li>
                        <li>Contact@yourcompany.com</li>
                    </ul>
                </div>
                <div class="single_footer">
                    <h4>INFORMATION</h4>
                    <ul>
                        <li>About us</li>
                        <li>Delivery Information</li>
                        <li>Privacy Policy</li>
                        <li>Terms & Conditions</li>
                        <li>Contact us</li>
                    </ul>
                </div>
                <div class="single_footer">
                    <h4>Service</h4>
                    <ul>
                        <li>My Account</li>
                        <li>Return</li>
                        <li>(+123) 685 78</li>
                        <li>(+123) 685 78</li>
                        <li>Contact@yourcompany.com</li>
                    </ul>
                </div>
            </div>
            <div class="footer_btm_area">
                <div class="footer_social_icon">
                    <ul class="footer_social_icon_list">
                        <li><a href=""><i class="fab fa-facebook-f"></i></a></li>
                        <li><a href=""><i class="fab fa-google"></i></a></li>
                        <li><a href=""><i class="fab fa-linkedin"></i></a></li>
                        <li><a href=""><i class="fab fa-twitter"></i></a></li>
                        <li><a href=""><i class="fas fa-rss"></i></a></li>
                    </ul>
                </div>
                <div class="footer_copyright">
                    <p class="copyright_text">Â© 2021 All Rights Reserved FancyShop</p>
                </div>
                <div class="footer_payment_icon">
                    <ul class="footer_payment_icon_list">
                        <li><a href=""><i class="fab fa-cc-paypal"></i></a></li>
                        <li><a href=""><i class="fab fa-cc-visa"></i></a></li>
                        <li><a href=""><i class="fab fa-cc-discover"></i></a></li>
                        <li><a href=""><i class="fab fa-cc-mastercard"></i></a></li>
                        <li><a href=""><i class="fab fa-cc-amex"></i></a></li>
                    </ul>
                </div>
            </div>
        </div>
    </footer>
</div>


<script>
    const capitalize = (str) => str && str.length > 0 ? str[0].toUpperCase() + str.slice(1,) : ''

    const parseCookie = str => {
        if (str === '') {
            return {}
        }
        return str
            .split(';')
            .map(v => v.split('='))
            .reduce((acc, v) => {
                acc[decodeURIComponent(v[0].trim())] = decodeURIComponent(v[1].trim());
                return acc;
            }, {});
    }

    const structuredCookie = parseCookie(document.cookie)
    const token = structuredCookie['token']

    async function getOrders() {
        return fetch('/orders', {
            method: 'GET', // *GET, POST, PUT, DELETE, etc.
            mode: 'same-origin', // no-cors, *cors, same-origin
            cache: 'no-cache', // *default, no-cache, reload, force-cache, only-if-cached
            credentials: 'same-origin', // include, *same-origin, omit
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `bearer ${token}`
            },
            redirect: 'follow', // manual, *follow, error
            referrerPolicy: 'no-referrer', // no-referrer, *no-referrer-when-downgrade, origin, origin-when-cross-origin, same-origin, strict-origin, strict-origin-when-cross-origin, unsafe-url
        }).then(x => {
            if (x.status >= 400) {
                if (x.status == 401) {
                    //unauthorized. Maybe out of session
                    document.cookie = "token="
                    alert('Your session has ended. Please log in again')
                    document.location.replace('/home.html')
                }
                throw new Error(x.statusText)
            }
            return x.json()
        }).catch(err => {
            alert(err.toString())
            return null
        })
    }

    function handleView(id) {
        window.location.href = `./order_detail.html?receipt_id=${id}`
    }

    async function start() {
        if (!structuredCookie['token']) {
            alert('You must login')
            setTimeout(() => document.location.replace('/login.html'), 200)
            return;
        }

        const orders = await getOrders()
        if (!orders) {
            return
        }

        const injectSpace = document.querySelector('.injectable-space')
        const space = document.querySelector('.board-space')

        if (orders.length === 0) {
            space.innerHTML = (`
                <h4 style="font-size: 20px">Your history is empty</h4>
            `)
        } else {
            injectSpace.innerHTML = (`
            ${orders.reduce((acc, cur) => {
                const {id = null, order_date = '', status,} = cur
                const highlight = status === 'pending'
                const canView = true;

                if (id !== null) {
                    return acc + `
                    <tr class="${highlight ? 'active-row' : 'normal-row'}">
                        <td>${id}</td>
                        <td>${order_date}</td>
                        <td>${capitalize(status)}</td>
                        <td>
                            <div>
                                ${canView ? `<button class="action-button" onclick="handleView(${id})">View</button>` : ''}
                            </div>
                        </td>
                    </tr>
                `;
                } else {
                    return acc
                }
            }, '')}

            `)
        }
    }

    start()
</script>


<script>

    const changeVisibility = (classNames, value, all = false) => {
        if (all === false) {
            classNames.forEach(className => {
                console.log(className)
                document.querySelector(`.${className}`).style.display = value ? 'initial' : 'none'
            })
        } else {
            classNames.forEach(className => {
                document.querySelectorAll(`.${className}`).forEach(e => {
                    e.style.display = value ? 'initial' : 'none'
                })
            })
        }
    }

    const handleChangeWith = (width) => {
        console.log(width)
        if (width <= 760) {
            changeVisibility(['women', 'men'], false)
            if (document.querySelector('.sign_up')) {
                document.querySelector('.sign_up').style['margin-left'] = '0px'
                document.querySelector('.sign_up').style['margin-right'] = '10px'
            }
            document.querySelector('.col_left').style['padding-left'] = '10px'

            document.querySelectorAll('.menu_item').forEach(e => {
                e.style['margin'] = '0px'
            })


            document.querySelectorAll('.pic>img').forEach(e => {
                e.style['height'] = 'auto'
            })

            document.querySelectorAll('.menu_item > a').forEach(e => {
                e.style['margin'] = '0px 10px';
            })

            document.querySelectorAll('.box_content').forEach(e => {
                e.style.display = 'none'
            })

            document.querySelector('.col_left').style['padding-left'] = '10px'

        } else {
            changeVisibility(['women', 'men'], true)
            document.querySelector('.col_left').style['padding-left'] = '0px'

            if (document.querySelector('.sign_up')) {
                document.querySelector('.sign_up').style['margin-left'] = '50px'
                document.querySelector('.sign_up').style['margin-right'] = '20px'
            }

            document.querySelector('.col_left').style['padding-left'] = '0px'

            document.querySelectorAll('.menu_item').forEach(e => {
                e.style['margin'] = '1px'
            })

            document.querySelectorAll('.menu_item > a').forEach(e => {
                e.style['margin'] = '0px 20px'
            })

            document.querySelectorAll('.box_content').forEach(e => {
                e.style.display = 'flex'
            })
            document.querySelectorAll('.pic>img').forEach(e => {
                e.style['height'] = '382px'
            })
        }
    }

    window.addEventListener('resize', (window) => {
        const {clientWidth: width} = document.documentElement
        handleChangeWith(width)
    })

    console.log(document.documentElement.clientWidth)
    handleChangeWith(document.documentElement.clientWidth)

</script>
</body>
</html>
